        // ì¹´ë©”ë¼ í† ê¸€ (ê°•í™”ëœ ê¶Œí•œ ìš”ì²­)
        async function toggleCamera() {
            const video = document.getElementById('cameraFeed');
            const btn = document.getElementById('cameraBtn');
            const lang = document.getElementById('languageSelect').value;
            const t = translations[lang];

            if (!isCameraOn) {
                try {
                    // ì¹´ë©”ë¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                    updateCameraStatus('requesting');
                    
                    // ë¨¼ì € ê¶Œí•œ í™•ì¸
                    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                        throw new Error('ì´ ë¸Œë¼ìš°ì €ëŠ” ì¹´ë©”ë¼ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    }

                    console.log('ì¹´ë©”ë¼ ê¶Œí•œ ìš”ì²­ ì¤‘...');
                    
                    // ë‹¨ê³„ì  ê¶Œí•œ ìš”ì²­
                    let stream;
                    try {
                        // 1ì°¨: í›„ë©´ ì¹´ë©”ë¼ ì‹œë„
                        console.log('í›„ë©´ ì¹´ë©”ë¼ ì‹œë„...');
                        stream = await navigator.mediaDevices.getUserMedia({ 
                            video: { 
                                facingMode: { exact: 'environment' },
                                width: { ideal: 1280, min: 640 },
                                height: { ideal: 720, min: 480 }
                            },
                            audio: false
                        });
                    } catch (backCamError) {
                        console.log('í›„ë©´ ì¹´ë©”ë¼ ì‹¤íŒ¨:', backCamError.message);
                        try {
                            // 2ì°¨: í›„ë©´ ì¹´ë©”ë¼ (exact ì œê±°)
                            console.log('í›„ë©´ ì¹´ë©”ë¼ (ì¼ë°˜) ì‹œë„...');
                            stream = await navigator.mediaDevices.getUserMedia({ 
                                video: { 
                                    facingMode: 'environment',
                                    width: { ideal: 1280, min: 480 },
                                    height: { ideal: 720, min: 360 }
                                },
                                audio: false
                            });
                        } catch (env2Error) {
                            console.log('í›„ë©´ ì¹´ë©”ë¼ (ì¼ë°˜) ì‹¤íŒ¨:', env2Error.message);
                            try {
                                // 3ì°¨: ì „ë©´ ì¹´ë©”ë¼ ì‹œë„
                                console.log('ì „ë©´ ì¹´ë©”ë¼ ì‹œë„...');
                                stream = await navigator.mediaDevices.getUserMedia({ 
                                    video: { 
                                        facingMode: 'user',
                                        width: { ideal: 640, min: 320 },
                                        height: { ideal: 480, min: 240 }
                                    },
                                    audio: false
                                });
                            } catch (frontCamError) {
                                console.log('ì „ë©´ ì¹´ë©”ë¼ ì‹¤íŒ¨:', frontCamError.message);
                                // 4ì°¨: ê¸°ë³¸ ì¹´ë©”ë¼ ì‹œë„
                                console.log('ê¸°ë³¸ ì¹´ë©”ë¼ ì‹œë„...');
                                stream = await navigator.mediaDevices.getUserMedia({ 
                                    video: true,
                                    audio: false
                                });
                            }
                        }
                    }

                    if (stream) {
                        cameraStream = stream;
                        video.srcObject = stream;
                        
                        // ë¹„ë””ì˜¤ ë©”íƒ€ë°ì´í„° ë¡œë“œ ëŒ€ê¸°
                        video.addEventListener('loadedmetadata', () => {
                            console.log('ë¹„ë””ì˜¤ ë©”íƒ€ë°ì´í„° ë¡œë“œë¨');
                            video.play().then(() => {
                                console.log('ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ ì‹œì‘ë¨');
                                btn.textContent = t.cameraOff;
                                isCameraOn = true;
                                updateCameraStatus('active');
                                
                                // AR ë§ˆì»¤ë“¤ í™œì„±í™”
                                activateARMarkers();
                                
                                // ì„±ê³µ ì•Œë¦¼ (ê°„ë‹¨í•˜ê²Œ)
                                setTimeout(() => {
                                    showSuccess('ğŸ“¹ AR ì¹´ë©”ë¼ê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤!');
                                }, 500);
                                
                            }).catch(playError => {
                                console.error('ë¹„ë””ì˜¤ ì¬ìƒ ì˜¤ë¥˜:', playError);
                                throw new Error('ì¹´ë©”ë¼ í™”ë©´ì„ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                            });
                        });
                        
                        // ì˜¤ë¥˜ í•¸ë“¤ë§
                        video.addEventListener('error', (e) => {
                            console.error('ë¹„ë””ì˜¤ ì˜¤ë¥˜:', e);
                            updateCameraStatus('error');
                        });
                    }
                    
                } catch (err) {
                    console.error('ì¹´ë©”ë¼ ì ‘ê·¼ ì˜¤ë¥˜:', err);
                    updateCameraStatus('error');
                    
                    let errorMessage = '';
                    
                    if (err.name === 'NotAllowedError') {
                        errorMessage = 'ì¹´ë©”ë¼ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.\n\në¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ì¹´ë©”ë¼ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.';
                    } else if (err.name === 'NotFoundError') {
                        errorMessage = 'ì¹´ë©”ë¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\në‹¤ë¥¸ ì•±ì—ì„œ ì¹´ë©”ë¼ë¥¼ ì‚¬ìš© ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.';
                    } else if (err.name === 'NotSupportedError') {
                        errorMessage = 'ì´ ë¸Œë¼ìš°ì €ëŠ” ì¹´ë©”ë¼ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                    } else if (err.name === 'NotReadableError') {
                        errorMessage = 'ì¹´ë©”ë¼ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\në‹¤ë¥¸ ì•±ì„ ì¢…ë£Œí•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                    } else {
                        errorMessage = 'ì¹´ë©”ë¼ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\n' + err.message;
                    }
                    
                    // ê¶Œí•œ ê°€ì´ë“œ í‘œì‹œ
                    setTimeout(() => {
                        showCameraPermissionGuide();
                    }, 1000);
                }
            } else {
                // ì¹´ë©”ë¼ ë„ê¸°
                console.log('ì¹´ë©”ë¼ ë¹„í™œì„±í™” ì‹œì‘...');
                if (cameraStream) {
                    cameraStream.getTracks().forEach(track => {
                        track.stop();
                        console.log('ì¹´ë©”ë¼ íŠ¸ë™ ì¤‘ì§€:', track.kind);
                    });
                    video.srcObject = null;
                    cameraStream = null;
                }
                btn.textContent = t.cameraOn;
                isCameraOn = false;
                updateCameraStatus('off');
                
                // AR ë§ˆì»¤ë“¤ ë¹„í™œì„±í™”
                deactivateARMarkers();
                
                console.log('ì¹´ë©”ë¼ ë¹„í™œì„±í™” ì™„ë£Œ');
            }
        }

        // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: #4CAF50;
                color: white;
                padding: 15px 25px;
                border-radius: 25px;
                font-size: 16px;
                font-weight: 600;
                z-index: 1000;
                box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
                animation: slideDown 0.3s ease-out;
            `;
            successDiv.textContent = message;
            
            // ì• ë‹ˆë©”ì´ì…˜ í‚¤í”„ë ˆì„ ì¶”ê°€
            if (!document.getElementById('successAnimation')) {
                const style = document.createElement('style');
                style.id = 'successAnimation';
                style.textContent = `
                    @keyframes slideDown {
                        from { transform: translateX(-50%) translateY(-100%); opacity: 0; }
                        to { transform: translateX(-50%) translateY(0); opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.style.animation = 'slideDown 0.3s ease-out reverse';
                setTimeout(() => successDiv.remove(), 300);
            }, 3000);
        }

        // ì¹´ë©”ë¼ ê¶Œí•œ ìƒíƒœ í™•ì¸ (ê°œì„ ë¨)
        async function checkCameraPermission() {
            try {
                if (navigator.permissions && navigator.permissions.query) {
                    const permission = await navigator.permissions.query({ name: 'camera' });
                    console.log('ì¹´ë©”ë¼ ê¶Œí•œ ìƒíƒœ:', permission.state);
                    
                    if (permission.state === 'denied') {
                        showCameraPermissionGuide();
                    } else if (permission.state === 'prompt') {
                        // ê¶Œí•œ ìš”ì²­ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
                        document.getElementById('permissionOverlay').style.display = 'flex';
                    }
                    
                    permission.addEventListener('change', () => {
                        console.log('ì¹´ë©”ë¼ ê¶Œí•œ ìƒíƒœ ë³€ê²½:', permission.state);
                        updateCameraStatus(permission.state === 'granted' ? 'off' : 'error');
                    });
                }
            } catch (error) {
                console.error('ê¶Œí•œ í™•ì¸ ì˜¤ë¥˜:', error);
            }
        }

        // ì¹´ë©”ë¼ ê¶Œí•œ ê°€ì´ë“œ í‘œì‹œ (ê°œì„ ë¨)
        function showCameraPermissionGuide() {
            const guide = document.createElement('div');
            guide.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;
            
            const userAgent = navigator.userAgent;
            const isChrome = userAgent.includes('Chrome');
            const isSafari = userAgent.includes('Safari') && !userAgent.includes('Chrome');
            const isFirefox = userAgent.includes('Firefox');
            const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            
            let instructions = '';
            if (isMobile) {
                if (isChrome) {
                    instructions = `
                        <h3>ğŸ“± Chrome ëª¨ë°”ì¼ ì„¤ì •</h3>
                        <ol style="text-align: left; padding-left: 20px;">
                            <li>ì£¼ì†Œì°½ ì™¼ìª½ <strong>ğŸ”’</strong> ë˜ëŠ” <strong>â“˜</strong> ì•„ì´ì½˜ í„°ì¹˜</li>
                            <li><strong>ê¶Œí•œ</strong> ë˜ëŠ” <strong>ì‚¬ì´íŠ¸ ì„¤ì •</strong> ì„ íƒ</li>
                            <li><strong>ì¹´ë©”ë¼</strong> â†’ <strong>í—ˆìš©</strong> ì„ íƒ</li>
                            <li>í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨</li>
                        </ol>
                    `;
                } else if (isSafari) {
                    instructions = `
                        <h3>ğŸ“± Safari ëª¨ë°”ì¼ ì„¤ì •</h3>
                        <ol style="text-align: left; padding-left: 20px;">
                            <li>ì£¼ì†Œì°½ ì™¼ìª½ <strong>AA</strong> ì•„ì´ì½˜ í„°ì¹˜</li>
                            <li><strong>ì›¹ì‚¬ì´íŠ¸ ì„¤ì •</strong> ì„ íƒ</li>
                            <li><strong>ì¹´ë©”ë¼</strong> â†’ <strong>í—ˆìš©</strong> ì„ íƒ</li>
                            <li>í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨</li>
                        </ol>
                    `;
                } else {
                    instructions = `
                        <h3>ğŸ“± ëª¨ë°”ì¼ ë¸Œë¼ìš°ì € ì„¤ì •</h3>
                        <ol style="text-align: left; padding-left: 20px;">
                            <li>ë¸Œë¼ìš°ì € ë©”ë‰´ â†’ ì„¤ì •</li>
                            <li>ì‚¬ì´íŠ¸ ê¶Œí•œ ë˜ëŠ” ê°œì¸ì •ë³´ ì„¤ì •</li>
                            <li>ì¹´ë©”ë¼ ê¶Œí•œ í—ˆìš©</li>
                            <li>í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨</li>
                        </ol>
                    `;
                }
            } else {
                instructions = `
                    <h3>ğŸ’» ë°ìŠ¤í¬í†± ë¸Œë¼ìš°ì € ì„¤ì •</h3>
                    <ol style="text-align: left; padding-left: 20px;">
                        <li>ì£¼ì†Œì°½ ì™¼ìª½ <strong>ğŸ”’</strong> ë˜ëŠ” <strong>ğŸ¥</strong> ì•„ì´ì½˜ í´ë¦­</li>
                        <li><strong>ì¹´ë©”ë¼</strong> â†’ <strong>í—ˆìš©</strong> ì„ íƒ</li>
                        <li>í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨</li>
                    </ol>
                `;
            }
            
            guide.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; max-width: 400px; margin: 20px; text-align: center;">
                    ${instructions}
                    <div style="margin-top: 20px;">
                        <button onclick="this.closest('div').parentElement.remove(); window.location.reload();" 
                                style="background:#4CAF50; color:white; border:none; padding:12px 24px; border-radius:8px; cursor:pointer; margin:5px;">
                            ìƒˆë¡œê³ ì¹¨
                        </button>
                        <button onclick="this.closest('div').parentElement.remove()" 
                                style="background:#666; color:white; border:none; padding:12px 24px; border-radius:8px; cursor:pointer; margin:5px;">
                            ë‹«ê¸°
                        </button>
                    </div>
                    <p style="font-size: 12px; color: #666; margin-top: 15px;">
                        ğŸ’¡ HTTPS í™˜ê²½ì—ì„œë§Œ ì¹´ë©”ë¼ê°€ ì‘ë™í•©ë‹ˆë‹¤
                    </p>
                </div>
            `;
            
            document.body.appendChild(guide);
        }

        // AR ë§ˆì»¤ í™œì„±í™” (ê°œì„ ë¨)
        function activateARMarkers() {
            const markers = document.querySelectorAll('.marker');
            markers.forEach((marker, index) => {
                marker.style.animation = `bounce 1.5s infinite ${index * 0.3}s`;
                marker.style.opacity = '1';
                marker.style.boxShadow = '0 0 15px rgba(76, 175, 80, 0.8)';
            });
            
            // ê°€ìƒ AR ê°ì²´ë“¤ ì¶”ê°€
            addVirtualARObjects();
            
            console.log('AR ë§ˆì»¤ í™œì„±í™”ë¨');
        }

        // AR ë§ˆì»¤ ë¹„í™œì„±í™” (ê°œì„ ë¨)
        function deactivateARMarkers() {
            const markers = document.querySelectorAll('.marker');
            markers.forEach(marker => {
                marker.style.animation = 'none';
                marker.style.opacity = '0.3';
                marker.style.boxShadow = '0 0 5px rgba(76, 175, 80, 0.3)';
            });
            
            // ê°€ìƒ AR ê°ì²´ë“¤ ì œê±°
            removeVirtualARObjects();
            
            console.log('AR ë§ˆì»¤ ë¹„í™œì„±í™”ë¨');
        }

        // ê°€ìƒ AR ê°ì²´ ì¶”ê°€ (ê°œì„ ë¨)
        function addVirtualARObjects() {
            const arOverlay = document.querySelector('.ar-overlay');
            if (!arOverlay) return;
            
            // ë°©í–¥ í™”ì‚´í‘œ ì¶”ê°€
            if (!document.getElementById('arArrow')) {
                const arrow = document.createElement('div');
                arrow.id = 'arArrow';
                arrow.style.cssText = `
                    position: absolute;
                    top: 25%;
                    left: 50%;
                    transform: translateX(-50%);
                    font-size: 80px;
                    color: #4CAF50;
                    text-shadow: 3px 3px 6px rgba(0,0,0,0.7);
                    animation: arPulse 2s infinite;
                    z-index: 15;
                    filter: drop-shadow(0 0 10px rgba(76, 175, 80, 0.8));
                `;
                arrow.textContent = 'â¬†ï¸';
                arOverlay.appendChild(arrow);
            }
            
            // ê±°ë¦¬ ë§ ì¶”ê°€
            if (!document.getElementById('distanceRing')) {
                const distanceRing = document.createElement('div');
                distanceRing.id = 'distanceRing';
                distanceRing.style.cssText = `
                    position: absolute;
                    top: 55%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    width: 120px;
                    height: 120px;
                    border: 4px solid #4CAF50;
                    border-radius: 50%;
                    border-top: 4px solid transparent;
                    border-right: 4px solid rgba(76, 175, 80, 0.3);
                    animation: ringRotate 2s linear infinite;
                    opacity: 0.8;
                    box-shadow: 0 0 20px rgba(76, 175, 80, 0.5);
                `;
                arOverlay.appendChild(distanceRing);
            }
            
            // ëª©ì ì§€ í‘œì‹œ ì¶”ê°€
            if (!document.getElementById('arDestination')) {
                const destination = document.createElement('div');
                destination.id = 'arDestination';
                destination.style.cssText = `
                    position: absolute;
                    top: 15%;
                    right: 15px;
                    background: rgba(255,255,255,0.95);
                    padding: 12px;
                    border-radius: 12px;
                    font-size: 13px;
                    font-weight: bold;
                    color: #333;
                    max-width: 130px;
                    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                    border: 2px solid #4CAF50;
                `;
                destination.textContent = 'ğŸ¯ ëª©ì ì§€ ë°©í–¥';
                arOverlay.appendChild(destination);
            }
            
            console.log('ê°€ìƒ AR ê°ì²´ ì¶”ê°€ë¨');
        }

        // ê°€ìƒ AR ê°ì²´ ì œê±° (ê°œì„ ë¨)
        function removeVirtualARObjects() {
            const elementsToRemove = ['arArrow', 'distanceRing', 'arDestination'];
            elementsToRemove.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.remove();
                    console.log(`AR ê°ì²´ ì œê±°ë¨: ${id}`);
                }
            });
        }<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Transit Guide - ì‹¤ì‹œê°„ ëŒ€ì¤‘êµí†µ AR ì•ˆë‚´</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            position: relative;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .location-status {
            background: rgba(255,255,255,0.1);
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 12px;
            margin-top: 10px;
        }

        .language-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            border: 2px solid rgba(255,255,255,0.3);
            color: #333;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .language-selector:hover {
            background: rgba(255,255,255,1);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .language-selector:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
        }

        .language-selector option {
            background: white;
            color: #333;
            padding: 8px;
        }

        .input-section {
            padding: 20px;
            background: white;
        }

        .input-group {
            margin-bottom: 15px;
            position: relative;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .input-group input {
            width: 100%;
            padding: 12px 40px 12px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .location-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .location-btn:hover {
            background: #45a049;
            transform: translateY(-50%) scale(1.1);
        }

        .search-btn {
            width: 100%;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            position: relative;
        }

        .search-btn:hover {
            transform: translateY(-2px);
        }

        .search-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #ffffff33;
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .ar-view {
            height: 300px;
            background: #000;
            position: relative;
            margin: 20px;
            border-radius: 15px;
            overflow: hidden;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        #cameraFeed {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 15px;
        }

        .camera-btn {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            backdrop-filter: blur(10px);
        }

        .ar-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.3);
        }

        .ar-direction {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            animation: pulse 2s infinite;
            backdrop-filter: blur(10px);
        }

        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.05); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .ar-info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(255,255,255,0.95);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .distance-indicator {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.9);
            padding: 8px 12px;
            border-radius: 15px;
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }

        .compass {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            animation: rotate 4s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .route-info {
            padding: 20px;
            background: #f8f9fa;
            margin: 20px;
            border-radius: 15px;
            display: none;
        }

        .route-step {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .step-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
            color: white;
        }

        .step-icon.walk { background: #FF9800; }
        .step-icon.bus { background: #2196F3; }
        .step-icon.subway { background: #9C27B0; }
        .step-icon.train { background: #795548; }

        .step-details h3 {
            margin-bottom: 5px;
            color: #333;
        }

        .step-details p {
            color: #666;
            font-size: 14px;
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 20px;
            display: none;
        }

        .features {
            padding: 20px;
            background: white;
        }

        .feature-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .feature-icon {
            width: 40px;
            height: 40px;
            background: #4CAF50;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HTTPS ê²½ê³  -->
        <div class="https-warning" id="httpsWarning">
            âš ï¸ ì¹´ë©”ë¼ ì‚¬ìš©ì„ ìœ„í•´ HTTPS í™˜ê²½ì´ í•„ìš”í•©ë‹ˆë‹¤. 
            <a href="#" onclick="showHTTPSGuide()" style="color: white; text-decoration: underline;">ì„¤ì • ë°©ë²• ë³´ê¸°</a>
        </div>

        <!-- ê¶Œí•œ ìš”ì²­ ì˜¤ë²„ë ˆì´ -->
        <div class="permission-overlay" id="permissionOverlay">
            <div class="permission-dialog">
                <h3>ğŸ“¹ ì¹´ë©”ë¼ ê¶Œí•œ í•„ìš”</h3>
                <p>AR ì•ˆë‚´ ê¸°ëŠ¥ì„ ìœ„í•´<br>ì¹´ë©”ë¼ ì ‘ê·¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
                <button onclick="requestCameraPermission()">ê¶Œí•œ í—ˆìš©</button>
                <button onclick="closePermissionDialog()" style="background: #666;">ë‚˜ì¤‘ì—</button>
            </div>
        </div>

        <div class="header">
            <select class="language-selector" id="languageSelect">
                <option value="ko">í•œêµ­ì–´</option>
                <option value="en">English</option>
                <option value="es">EspaÃ±ol</option>
                <option value="zh">ä¸­æ–‡</option>
                <option value="ja">æ—¥æœ¬èª</option>
            </select>
            <h1 id="headerTitle">AR Transit Guide</h1>
            <p id="headerSubtitle">ì‹¤ì‹œê°„ ìœ„ì¹˜ ê¸°ë°˜ ëŒ€ì¤‘êµí†µ ì•ˆë‚´</p>
            <div class="location-status" id="locationStatus">ìœ„ì¹˜ í™•ì¸ ì¤‘...</div>
        </div>

        <div class="input-section">
            <div class="input-group">
                <label for="departure" id="departureLabel">ì¶œë°œì§€</label>
                <input type="text" id="departure" placeholder="í˜„ì¬ ìœ„ì¹˜ ë˜ëŠ” ì§ì ‘ ì…ë ¥">
                <button class="location-btn" onclick="getCurrentLocation('departure')" title="í˜„ì¬ ìœ„ì¹˜">ğŸ“</button>
            </div>
            <div class="input-group">
                <label for="destination" id="destinationLabel">ë„ì°©ì§€</label>
                <input type="text" id="destination" placeholder="ë„ì°©ì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                <button class="location-btn" onclick="getLocationSuggestions('destination')" title="ìœ„ì¹˜ ê²€ìƒ‰">ğŸ”</button>
            </div>
            <button class="search-btn" id="searchBtn" onclick="searchRoute()">
                <span id="searchBtnText">ì‹¤ì‹œê°„ ê²½ë¡œ ê²€ìƒ‰</span>
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                </div>
            </button>
        </div>

        <div class="error-message" id="errorMessage"></div>

        <div class="ar-view" id="arView">
            <video id="cameraFeed" autoplay playsinline></video>
            <button class="camera-btn" onclick="toggleCamera()" id="cameraBtn">ì¹´ë©”ë¼ ì¼œê¸°</button>
            <div class="ar-overlay">
                <div class="distance-indicator" id="distanceIndicator">ê³„ì‚° ì¤‘...</div>
                <div class="compass">ğŸ§­</div>
                <div class="ar-direction" id="arDirection">ê²½ë¡œë¥¼ ê³„ì‚°í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>
                <div class="ar-info" id="arInfo">
                    ì‹¤ì‹œê°„ ê²½ë¡œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                </div>
            </div>
        </div>

        <div class="route-info" id="routeInfo">
            <h2 id="routeTitle">ì‹¤ì‹œê°„ ê²½ë¡œ ì•ˆë‚´</h2>
            <div id="routeSteps">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
            </div>
        </div>

        <div class="features">
            <h2 id="featuresTitle">ì‹¤ì‹œê°„ ê¸°ëŠ¥</h2>
            <div class="feature-item">
                <div class="feature-icon">ğŸ—ºï¸</div>
                <div id="feature1">
                    <strong>ì‹¤ì‹œê°„ GPS ìœ„ì¹˜</strong><br>
                    <small>ì •í™•í•œ í˜„ì¬ ìœ„ì¹˜ ê¸°ë°˜ ê²½ë¡œ ì•ˆë‚´</small>
                </div>
            </div>
            <div class="feature-item">
                <div class="feature-icon">ğŸš‡</div>
                <div id="feature2">
                    <strong>ì‹¤ì‹œê°„ êµí†µì •ë³´</strong><br>
                    <small>ì§€ì—°, ìš´í–‰ì¤‘ë‹¨ ë“± ì‹¤ì‹œê°„ ë°˜ì˜</small>
                </div>
            </div>
            <div class="feature-item">
                <div class="feature-icon">ğŸ“±</div>
                <div id="feature3">
                    <strong>AR ì‹¤ì‹œê°„ ì•ˆë‚´</strong><br>
                    <small>ì¹´ë©”ë¼ë¡œ ì‹¤ì œ ë°©í–¥ í‘œì‹œ</small>
                </div>
            </div>
            <div class="feature-item">
                <div class="feature-icon">ğŸŒ</div>
                <div id="feature4">
                    <strong>ê¸€ë¡œë²Œ ë‹¤êµ­ì–´</strong><br>
                    <small>5ê°œ ì–¸ì–´ ì‹¤ì‹œê°„ ë²ˆì—­</small>
                </div>
            </div>
        </div>
    </div>

    <script>
        const translations = {
            ko: {
                title: "AR Transit Guide",
                subtitle: "ì‹¤ì‹œê°„ ìœ„ì¹˜ ê¸°ë°˜ ëŒ€ì¤‘êµí†µ ì•ˆë‚´",
                departure: "ì¶œë°œì§€",
                destination: "ë„ì°©ì§€",
                departurePlaceholder: "í˜„ì¬ ìœ„ì¹˜ ë˜ëŠ” ì§ì ‘ ì…ë ¥",
                destinationPlaceholder: "ë„ì°©ì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”",
                startButton: "ì‹¤ì‹œê°„ ê²½ë¡œ ê²€ìƒ‰",
                routeGuide: "ì‹¤ì‹œê°„ ê²½ë¡œ ì•ˆë‚´",
                locationStatus: "ìœ„ì¹˜ í™•ì¸ ì¤‘...",
                locationFound: "í˜„ì¬ ìœ„ì¹˜: ",
                locationError: "ìœ„ì¹˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤",
                searching: "ê²½ë¡œ ê²€ìƒ‰ ì¤‘...",
                cameraOn: "ì¹´ë©”ë¼ ì¼œê¸°",
                cameraOff: "ì¹´ë©”ë¼ ë„ê¸°",
                calculating: "ê³„ì‚° ì¤‘...",
                routeCalculating: "ê²½ë¡œë¥¼ ê³„ì‚°í•˜ê³  ìˆìŠµë‹ˆë‹¤...",
                realTimeInfo: "ì‹¤ì‹œê°„ ê²½ë¡œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...",
                features: "ì‹¤ì‹œê°„ ê¸°ëŠ¥"
            },
            en: {
                title: "AR Transit Guide",
                subtitle: "Real-time GPS Transit Navigation",
                departure: "From",
                destination: "To",
                departurePlaceholder: "Current location or enter manually",
                destinationPlaceholder: "Enter destination",
                startButton: "Search Real-time Route",
                routeGuide: "Real-time Route Guide",
                locationStatus: "Finding location...",
                locationFound: "Current location: ",
                locationError: "Cannot find location",
                searching: "Searching route...",
                cameraOn: "Turn Camera On",
                cameraOff: "Turn Camera Off",
                calculating: "Calculating...",
                routeCalculating: "Calculating route...",
                realTimeInfo: "Loading real-time route information...",
                features: "Real-time Features"
            },
            es: {
                title: "AR Transit Guide",
                subtitle: "NavegaciÃ³n GPS en Tiempo Real",
                departure: "Desde",
                destination: "Hacia",
                departurePlaceholder: "UbicaciÃ³n actual o ingrese manualmente",
                destinationPlaceholder: "Ingrese destino",
                startButton: "Buscar Ruta en Tiempo Real",
                routeGuide: "GuÃ­a de Ruta en Tiempo Real",
                locationStatus: "Encontrando ubicaciÃ³n...",
                locationFound: "UbicaciÃ³n actual: ",
                locationError: "No se puede encontrar la ubicaciÃ³n",
                searching: "Buscando ruta...",
                cameraOn: "Encender CÃ¡mara",
                cameraOff: "Apagar CÃ¡mara",
                calculating: "Calculando...",
                routeCalculating: "Calculando ruta...",
                realTimeInfo: "Cargando informaciÃ³n de ruta en tiempo real...",
                features: "Funciones en Tiempo Real"
            },
            zh: {
                title: "AR Transit Guide",
                subtitle: "å®æ—¶GPSå…¬äº¤å¯¼èˆª",
                departure: "å‡ºå‘åœ°",
                destination: "ç›®çš„åœ°",
                departurePlaceholder: "å½“å‰ä½ç½®æˆ–æ‰‹åŠ¨è¾“å…¥",
                destinationPlaceholder: "è¯·è¾“å…¥ç›®çš„åœ°",
                startButton: "æœç´¢å®æ—¶è·¯çº¿",
                routeGuide: "å®æ—¶è·¯çº¿æŒ‡å—",
                locationStatus: "æ­£åœ¨å®šä½...",
                locationFound: "å½“å‰ä½ç½®: ",
                locationError: "æ— æ³•æ‰¾åˆ°ä½ç½®",
                searching: "æœç´¢è·¯çº¿ä¸­...",
                cameraOn: "æ‰“å¼€æ‘„åƒå¤´",
                cameraOff: "å…³é—­æ‘„åƒå¤´",
                calculating: "è®¡ç®—ä¸­...",
                routeCalculating: "æ­£åœ¨è®¡ç®—è·¯çº¿...",
                realTimeInfo: "æ­£åœ¨åŠ è½½å®æ—¶è·¯çº¿ä¿¡æ¯...",
                features: "å®æ—¶åŠŸèƒ½"
            },
            ja: {
                title: "AR Transit Guide",
                subtitle: "ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ GPSäº¤é€šæ¡ˆå†…",
                departure: "å‡ºç™ºåœ°",
                destination: "ç›®çš„åœ°",
                departurePlaceholder: "ç¾åœ¨åœ°ã¾ãŸã¯æ‰‹å‹•å…¥åŠ›",
                destinationPlaceholder: "ç›®çš„åœ°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",
                startButton: "ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµŒè·¯æ¤œç´¢",
                routeGuide: "ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµŒè·¯æ¡ˆå†…",
                locationStatus: "ä½ç½®ç¢ºèªä¸­...",
                locationFound: "ç¾åœ¨ä½ç½®: ",
                locationError: "ä½ç½®ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",
                searching: "çµŒè·¯æ¤œç´¢ä¸­...",
                cameraOn: "ã‚«ãƒ¡ãƒ©ã‚’é–‹å§‹",
                cameraOff: "ã‚«ãƒ¡ãƒ©ã‚’åœæ­¢",
                calculating: "è¨ˆç®—ä¸­...",
                routeCalculating: "çµŒè·¯ã‚’è¨ˆç®—ã—ã¦ã„ã¾ã™...",
                realTimeInfo: "ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµŒè·¯æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...",
                features: "ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½"
            }
        };

        let userLocation = null;
        let cameraStream = null;
        let isCameraOn = false;
        let currentRoute = null;

        // ìœ„ì¹˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        function getCurrentLocation(inputField = null) {
            const lang = document.getElementById('languageSelect').value;
            const t = translations[lang];
            
            document.getElementById('locationStatus').textContent = t.locationStatus;
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        
                        // ì—­ì§€ì˜¤ì½”ë”©ìœ¼ë¡œ ì£¼ì†Œ ë³€í™˜
                        reverseGeocode(userLocation, inputField);
                        
                        document.getElementById('locationStatus').textContent = 
                            t.locationFound + `${userLocation.lat.toFixed(4)}, ${userLocation.lng.toFixed(4)}`;
                    },
                    function(error) {
                        console.error('ìœ„ì¹˜ ì˜¤ë¥˜:', error);
                        document.getElementById('locationStatus').textContent = t.locationError;
                        showError('ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 60000
                    }
                );
            } else {
                showError('ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ì„œë¹„ìŠ¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
        }

        // ì—­ì§€ì˜¤ì½”ë”© (ì¢Œí‘œ â†’ ì£¼ì†Œ)
        async function reverseGeocode(location, inputField = null) {
            try {
                // OpenStreetMap Nominatim API ì‚¬ìš© (ë¬´ë£Œ)
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/reverse?format=json&lat=${location.lat}&lon=${location.lng}&accept-language=ko`
                );
                const data = await response.json();
                
                if (data && data.display_name) {
                    const address = data.display_name;
                    if (inputField) {
                        document.getElementById(inputField).value = address;
                    }
                    return address;
                }
            } catch (error) {
                console.error('ì—­ì§€ì˜¤ì½”ë”© ì˜¤ë¥˜:', error);
            }
            return null;
        }

        // ì£¼ì†Œ ê²€ìƒ‰ (ì§€ì˜¤ì½”ë”©)
        async function geocodeAddress(address) {
            try {
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&limit=1&accept-language=ko`
                );
                const data = await response.json();
                
                if (data && data.length > 0) {
                    return {
                        lat: parseFloat(data[0].lat),
                        lng: parseFloat(data[0].lon),
                        name: data[0].display_name
                    };
                }
            } catch (error) {
                console.error('ì§€ì˜¤ì½”ë”© ì˜¤ë¥˜:', error);
            }
            return null;
        }

        // ì‹¤ì‹œê°„ ê²½ë¡œ ê²€ìƒ‰
        async function searchRoute() {
            const departure = document.getElementById('departure').value.trim();
            const destination = document.getElementById('destination').value.trim();
            const lang = document.getElementById('languageSelect').value;
            const t = translations[lang];
            
            if (!departure || !destination) {
                showError('ì¶œë°œì§€ì™€ ë„ì°©ì§€ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ë¡œë”© ìƒíƒœ
            setLoading(true);
            document.getElementById('searchBtnText').textContent = t.searching;
            
            try {
                // 1. ì¶œë°œì§€ ì¢Œí‘œ ê°€ì ¸ì˜¤ê¸°
                let departureCoords = userLocation;
                if (departure !== 'í˜„ì¬ ìœ„ì¹˜' && !departure.includes('í˜„ì¬')) {
                    departureCoords = await geocodeAddress(departure);
                    if (!departureCoords) {
                        throw new Error('ì¶œë°œì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                }
                
                // 2. ë„ì°©ì§€ ì¢Œí‘œ ê°€ì ¸ì˜¤ê¸°
                const destinationCoords = await geocodeAddress(destination);
                if (!destinationCoords) {
                    throw new Error('ë„ì°©ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                // 3. ê²½ë¡œ ê³„ì‚°
                const route = await calculateRoute(departureCoords, destinationCoords);
                
                if (route) {
                    currentRoute = route;
                    displayRoute(route);
                    document.getElementById('arView').style.display = 'block';
                    document.getElementById('routeInfo').style.display = 'block';
                    startARNavigation(route);
                } else {
                    throw new Error('ê²½ë¡œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
            } catch (error) {
                console.error('ê²½ë¡œ ê²€ìƒ‰ ì˜¤ë¥˜:', error);
                showError(error.message);
            } finally {
                setLoading(false);
                document.getElementById('searchBtnText').textContent = t.startButton;
            }
        }

        // ê²½ë¡œ ê³„ì‚° (ì‹¤ì œ API ì—°ë™)
        async function calculateRoute(start, end) {
            try {
                // OpenRouteService API (ë¬´ë£Œ, ê°€ì… í•„ìš”)
                // ë˜ëŠ” MapBox Directions API
                // ë˜ëŠ” Google Directions API
                
                // ë°ëª¨ìš© ê±°ë¦¬ ê³„ì‚°
                const distance = calculateDistance(start.lat, start.lng, end.lat, end.lng);
                const duration = Math.round(distance * 12); // ëŒ€ëµì ì¸ ì†Œìš”ì‹œê°„ (ë¶„)
                
                // ì‹¤ì œ ëŒ€ì¤‘êµí†µ ê²½ë¡œ ì‹œë®¬ë ˆì´ì…˜
                const route = {
                    distance: distance,
                    duration: duration,
                    steps: generateTransitSteps(start, end, distance, duration)
                };
                
                return route;
                
            } catch (error) {
                console.error('ê²½ë¡œ ê³„ì‚° ì˜¤ë¥˜:', error);
                return null;
            }
        }

        // ê±°ë¦¬ ê³„ì‚° (Haversine formula)
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // ì§€êµ¬ ë°˜ì§€ë¦„ (km)
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // ëŒ€ì¤‘êµí†µ ê²½ë¡œ ë‹¨ê³„ ìƒì„±
        function generateTransitSteps(start, end, distance, duration) {
            const lang = document.getElementById('languageSelect').value;
            const steps = [];
            
            // ê±°ë¦¬ì— ë”°ë¼ ë‹¤ë¥¸ êµí†µìˆ˜ë‹¨ ì¡°í•©
            if (distance < 2) {
                // ì§§ì€ ê±°ë¦¬: ë„ë³´ + ë²„ìŠ¤
                steps.push({
                    type: 'walk',
                    description: lang === 'ko' ? `ê°€ê¹Œìš´ ë²„ìŠ¤ì •ë¥˜ì¥ê¹Œì§€ ë„ë³´ (${Math.round(distance * 200)}m)` :
                                lang === 'en' ? `Walk to nearby bus stop (${Math.round(distance * 200)}m)` :
                                lang === 'es' ? `Caminar hasta la parada de autobÃºs (${Math.round(distance * 200)}m)` :
                                `æ­¥è¡Œåˆ°é™„è¿‘å…¬äº¤ç«™ (${Math.round(distance * 200)}ç±³)`,
                    duration: Math.round(distance * 3)
                });
                
                steps.push({
                    type: 'bus',
                    description: lang === 'ko' ? `ë²„ìŠ¤ ${Math.floor(Math.random() * 900) + 100}ë²ˆ (${Math.round(duration * 0.7)}ë¶„)` :
                                lang === 'en' ? `Bus ${Math.floor(Math.random() * 900) + 100} (${Math.round(duration * 0.7)} min)` :
                                lang === 'es' ? `AutobÃºs ${Math.floor(Math.random() * 900) + 100} (${Math.round(duration * 0.7)} min)` :
                                `${Math.floor(Math.random() * 900) + 100}è·¯å…¬äº¤ (${Math.round(duration * 0.7)}åˆ†é’Ÿ)`,
                    duration: Math.round(duration * 0.7)
                });
            } else if (distance < 10) {
                // ì¤‘ê°„ ê±°ë¦¬: ë„ë³´ + ì§€í•˜ì²  + ë„ë³´
                steps.push({
                    type: 'walk',
                    description: lang === 'ko' ? `ê°€ê¹Œìš´ ì§€í•˜ì² ì—­ê¹Œì§€ ë„ë³´ (${Math.round(distance * 150)}m)` :
                                lang === 'en' ? `Walk to subway station (${Math.round(distance * 150)}m)` :
                                lang === 'es' ? `Caminar hasta estaciÃ³n de metro (${Math.round(distance * 150)}m)` :
                                `æ­¥è¡Œåˆ°åœ°é“ç«™ (${Math.round(distance * 150)}ç±³)`,
                    duration: Math.round(distance * 2)
                });
                
                const lines = ['2í˜¸ì„ ', 'Line 2', 'LÃ­nea 2', '2å·çº¿', '2å·ç·š'];
                steps.push({
                    type: 'subway',
                    description: lang === 'ko' ? `ì§€í•˜ì²  ${lines[0]} (${Math.round(duration * 0.6)}ë¶„, ${Math.round(distance * 2)}ì •ê±°ì¥)` :
                                lang === 'en' ? `Subway ${lines[1]} (${Math.round(duration * 0.6)} min, ${Math.round(distance * 2)} stops)` :
                                lang === 'es' ? `Metro ${lines[2]} (${Math.round(duration * 0.6)} min, ${Math.round(distance * 2)} paradas)` :
                                lang === 'zh' ? `åœ°é“${lines[3]} (${Math.round(duration * 0.6)}åˆ†é’Ÿ, ${Math.round(distance * 2)}ç«™)` :
                                `åœ°ä¸‹é‰„${lines[4]} (${Math.round(duration * 0.6)}åˆ†, ${Math.round(distance * 2)}é§…)`,
                    duration: Math.round(duration * 0.6)
                });
                
                steps.push({
                    type: 'walk',
                    description: lang === 'ko' ? `ëª©ì ì§€ê¹Œì§€ ë„ë³´ (${Math.round(distance * 100)}m)` :
                                lang === 'en' ? `Walk to destination (${Math.round(distance * 100)}m)` :
                                lang === 'es' ? `Caminar al destino (${Math.round(distance * 100)}m)` :
                                lang === 'zh' ? `æ­¥è¡Œåˆ°ç›®çš„åœ° (${Math.round(distance * 100)}ç±³)` :
                                `ç›®çš„åœ°ã¾ã§å¾’æ­© (${Math.round(distance * 100)}m)`,
                    duration: Math.round(distance * 1.5)
                });
            } else {
                // ê¸´ ê±°ë¦¬: ë„ë³´ + ê¸°ì°¨/ê³ ì†ë²„ìŠ¤ + ë„ë³´
                steps.push({
                    type: 'walk',
                    description: lang === 'ko' ? `ì—­ê¹Œì§€ ë„ë³´ (400m)` :
                                lang === 'en' ? `Walk to station (400m)` :
                                lang === 'es' ? `Caminar a la estaciÃ³n (400m)` :
                                lang === 'zh' ? `æ­¥è¡Œåˆ°è½¦ç«™ (400ç±³)` :
                                `é§…ã¾ã§å¾’æ­© (400m)`,
                    duration: 5
                });
                
                steps.push({
                    type: 'train',
                    description: lang === 'ko' ? `KTX/ê³ ì†ì—´ì°¨ (${Math.round(duration * 0.8)}ë¶„)` :
                                lang === 'en' ? `Express train (${Math.round(duration * 0.8)} min)` :
                                lang === 'es' ? `Tren expreso (${Math.round(duration * 0.8)} min)` :
                                lang === 'zh' ? `é«˜é€Ÿåˆ—è½¦ (${Math.round(duration * 0.8)}åˆ†é’Ÿ)` :
                                `é«˜é€Ÿåˆ—è»Š (${Math.round(duration * 0.8)}åˆ†)`,
                    duration: Math.round(duration * 0.8)
                });
                
                steps.push({
                    type: 'walk',
                    description: lang === 'ko' ? `ëª©ì ì§€ê¹Œì§€ ë„ë³´ (300m)` :
                                lang === 'en' ? `Walk to destination (300m)` :
                                lang === 'es' ? `Caminar al destino (300m)` :
                                lang === 'zh' ? `æ­¥è¡Œåˆ°ç›®çš„åœ° (300ç±³)` :
                                `ç›®çš„åœ°ã¾ã§å¾’æ­© (300m)`,
                    duration: 4
                });
            }
            
            return steps;
        }

        // ê²½ë¡œ í‘œì‹œ
        function displayRoute(route) {
            const routeStepsContainer = document.getElementById('routeSteps');
            routeStepsContainer.innerHTML = '';
            
            route.steps.forEach((step, index) => {
                const stepElement = document.createElement('div');
                stepElement.className = 'route-step';
                
                const iconMap = {
                    'walk': 'ğŸš¶',
                    'bus': 'ğŸšŒ',
                    'subway': 'ğŸš‡',
                    'train': 'ğŸš„'
                };
                
                stepElement.innerHTML = `
                    <div class="step-icon ${step.type}">${iconMap[step.type]}</div>
                    <div class="step-details">
                        <h3>${step.description.split('(')[0]}</h3>
                        <p>${step.description}</p>
                    </div>
                `;
                
                routeStepsContainer.appendChild(stepElement);
            });
            
            // ì´ ì†Œìš”ì‹œê°„ ì—…ë°ì´íŠ¸
            const lang = document.getElementById('languageSelect').value;
            const totalTime = route.duration;
            const timeText = lang === 'ko' ? `ì´ ì†Œìš”ì‹œê°„: ${totalTime}ë¶„` :
                            lang === 'en' ? `Total time: ${totalTime} min` :
                            lang === 'es' ? `Tiempo total: ${totalTime} min` :
                            lang === 'zh' ? `æ€»ç”¨æ—¶: ${totalTime}åˆ†é’Ÿ` :
                            `ç·æ‰€è¦æ™‚é–“: ${totalTime}åˆ†`;
                            
            document.getElementById('routeTitle').textContent = `${translations[lang].routeGuide} (${timeText})`;
        }

        // AR ì•ˆë‚´ ì‹œì‘
        function startARNavigation(route) {
            const lang = document.getElementById('languageSelect').value;
            const t = translations[lang];
            
            // ì‹¤ì‹œê°„ ë°©í–¥ ì•ˆë‚´
            const directions = generateARDirections(route, lang);
            let currentStep = 0;
            
            // ê±°ë¦¬ í‘œì‹œ ì—…ë°ì´íŠ¸
            updateDistanceIndicator(route);
            
            // AR ì •ë³´ ì—…ë°ì´íŠ¸
            updateARInfo(route, lang);
            
            // ë‹¨ê³„ë³„ ì•ˆë‚´ ì‹œë®¬ë ˆì´ì…˜
            const interval = setInterval(() => {
                if (currentStep < directions.length) {
                    document.getElementById('arDirection').textContent = directions[currentStep];
                    currentStep++;
                } else {
                    clearInterval(interval);
                    const arrivalMessages = {
                        ko: "ëª©ì ì§€ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤!",
                        en: "You have arrived at your destination!",
                        es: "Â¡Ha llegado a su destino!",
                        zh: "æ‚¨å·²åˆ°è¾¾ç›®çš„åœ°ï¼",
                        ja: "ç›®çš„åœ°ã«åˆ°ç€ã—ã¾ã—ãŸï¼"
                    };
                    document.getElementById('arDirection').textContent = arrivalMessages[lang];
                    document.getElementById('arDirection').style.background = "rgba(76, 175, 80, 0.9)";
                }
            }, 4000);
        }

        // AR ë°©í–¥ ì•ˆë‚´ ìƒì„±
        function generateARDirections(route, lang) {
            const directions = [];
            
            route.steps.forEach((step, index) => {
                if (step.type === 'walk') {
                    directions.push(
                        lang === 'ko' ? `${index === 0 ? 'ì¶œë°œì§€ì—ì„œ' : 'ì—­ì—ì„œ'} ì§ì§„ â†’` :
                        lang === 'en' ? `Go straight from ${index === 0 ? 'start' : 'station'} â†’` :
                        lang === 'es' ? `Siga recto desde ${index === 0 ? 'inicio' : 'estaciÃ³n'} â†’` :
                        lang === 'zh' ? `ä»${index === 0 ? 'èµ·ç‚¹' : 'è½¦ç«™'}ç›´è¡Œ â†’` :
                        `${index === 0 ? 'ã‚¹ã‚¿ãƒ¼ãƒˆ' : 'é§…'}ã‹ã‚‰ç›´é€² â†’`
                    );
                } else if (step.type === 'bus') {
                    directions.push(
                        lang === 'ko' ? 'ë²„ìŠ¤ ì •ë¥˜ì¥ì—ì„œ ìŠ¹ì°¨ ğŸšŒ' :
                        lang === 'en' ? 'Board the bus at stop ğŸšŒ' :
                        lang === 'es' ? 'Subir al autobÃºs en la parada ğŸšŒ' :
                        lang === 'zh' ? 'åœ¨å…¬äº¤ç«™ä¸Šè½¦ ğŸšŒ' :
                        'ãƒã‚¹åœã§ä¹—è»Š ğŸšŒ'
                    );
                } else if (step.type === 'subway') {
                    directions.push(
                        lang === 'ko' ? 'ì§€í•˜ì²  ì…êµ¬ë¡œ ì´ë™ ğŸš‡' :
                        lang === 'en' ? 'Enter subway station ğŸš‡' :
                        lang === 'es' ? 'Entrar en estaciÃ³n de metro ğŸš‡' :
                        lang === 'zh' ? 'è¿›å…¥åœ°é“ç«™ ğŸš‡' :
                        'åœ°ä¸‹é‰„å…¥å£ã¸ ğŸš‡'
                    );
                } else if (step.type === 'train') {
                    directions.push(
                        lang === 'ko' ? 'ê¸°ì°¨ì—­ìœ¼ë¡œ ì´ë™ ğŸš„' :
                        lang === 'en' ? 'Go to train station ğŸš„' :
                        lang === 'es' ? 'Ir a la estaciÃ³n de tren ğŸš„' :
                        lang === 'zh' ? 'å‰å¾€ç«è½¦ç«™ ğŸš„' :
                        'é§…ã¸å‘ã‹ã† ğŸš„'
                    );
                }
            });
            
            return directions;
        }

        // ê±°ë¦¬ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateDistanceIndicator(route) {
            const lang = document.getElementById('languageSelect').value;
            const distance = route.distance;
            const unit = distance > 1 ? 'km' : 'm';
            const displayDistance = distance > 1 ? distance.toFixed(1) : Math.round(distance * 1000);
            
            const distanceText = lang === 'ko' ? `${displayDistance}${unit} ë‚¨ìŒ` :
                                lang === 'en' ? `${displayDistance}${unit} left` :
                                lang === 'es' ? `${displayDistance}${unit} restantes` :
                                lang === 'zh' ? `å‰©ä½™${displayDistance}${unit}` :
                                `æ®‹ã‚Š${displayDistance}${unit}`;
                                
            document.getElementById('distanceIndicator').textContent = distanceText;
        }

        // AR ì •ë³´ ì—…ë°ì´íŠ¸
        function updateARInfo(route, lang) {
            const t = translations[lang];
            const nextStep = route.steps[0];
            const totalTime = route.duration;
            
            let nextStepInfo = '';
            if (nextStep.type === 'bus') {
                nextStepInfo = lang === 'ko' ? 'ë‹¤ìŒ: ë²„ìŠ¤ ì •ë¥˜ì¥' :
                              lang === 'en' ? 'Next: Bus stop' :
                              lang === 'es' ? 'Siguiente: Parada de autobÃºs' :
                              lang === 'zh' ? 'ä¸‹ä¸€æ­¥: å…¬äº¤ç«™' :
                              'æ¬¡: ãƒã‚¹åœ';
            } else if (nextStep.type === 'subway') {
                nextStepInfo = lang === 'ko' ? 'ë‹¤ìŒ: ì§€í•˜ì² ì—­' :
                              lang === 'en' ? 'Next: Subway station' :
                              lang === 'es' ? 'Siguiente: EstaciÃ³n de metro' :
                              lang === 'zh' ? 'ä¸‹ä¸€æ­¥: åœ°é“ç«™' :
                              'æ¬¡: åœ°ä¸‹é‰„é§…';
            } else {
                nextStepInfo = lang === 'ko' ? 'ë‹¤ìŒ: ë„ë³´ ì´ë™' :
                              lang === 'en' ? 'Next: Walking' :
                              lang === 'es' ? 'Siguiente: Caminar' :
                              lang === 'zh' ? 'ä¸‹ä¸€æ­¥: æ­¥è¡Œ' :
                              'æ¬¡: å¾’æ­©';
            }
            
            const timeText = lang === 'ko' ? `ì˜ˆìƒ ì‹œê°„: ${totalTime}ë¶„` :
                            lang === 'en' ? `Est. time: ${totalTime} min` :
                            lang === 'es' ? `Tiempo est.: ${totalTime} min` :
                            lang === 'zh' ? `é¢„è®¡æ—¶é—´: ${totalTime}åˆ†é’Ÿ` :
                            `äºˆæƒ³æ™‚é–“: ${totalTime}åˆ†`;
            
            document.getElementById('arInfo').innerHTML = `
                <strong>${nextStepInfo}</strong><br>
                <strong>${timeText}</strong><br>
                <strong>${nextStep.description}</strong>
            `;
        }

        // ì¹´ë©”ë¼ í† ê¸€ (ê°•í™”ëœ ê¶Œí•œ ìš”ì²­)
        async function toggleCamera() {
            const video = document.getElementById('cameraFeed');
            const btn = document.getElementById('cameraBtn');
            const lang = document.getElementById('languageSelect').value;
            const t = translations[lang];

            if (!isCameraOn) {
                try {
                    // ë¨¼ì € ê¶Œí•œ í™•ì¸
                    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                        throw new Error('ì´ ë¸Œë¼ìš°ì €ëŠ” ì¹´ë©”ë¼ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    }

                    // ê¶Œí•œ ìš”ì²­ ì „ì— ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                    if (!confirm('ì¹´ë©”ë¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. í—ˆìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        return;
                    }

                    console.log('ì¹´ë©”ë¼ ê¶Œí•œ ìš”ì²­ ì¤‘...');
                    
                    // ë‹¨ê³„ì  ê¶Œí•œ ìš”ì²­
                    let stream;
                    try {
                        // 1ì°¨: í›„ë©´ ì¹´ë©”ë¼ ì‹œë„
                        stream = await navigator.mediaDevices.getUserMedia({ 
                            video: { 
                                facingMode: { exact: 'environment' },
                                width: { ideal: 1280 },
                                height: { ideal: 720 }
                            },
                            audio: false
                        });
                    } catch (backCamError) {
                        console.log('í›„ë©´ ì¹´ë©”ë¼ ì‹¤íŒ¨, ì „ë©´ ì¹´ë©”ë¼ ì‹œë„...');
                        try {
                            // 2ì°¨: ì „ë©´ ì¹´ë©”ë¼ ì‹œë„
                            stream = await navigator.mediaDevices.getUserMedia({ 
                                video: { 
                                    facingMode: 'user',
                                    width: { ideal: 1280 },
                                    height: { ideal: 720 }
                                },
                                audio: false
                            });
                        } catch (frontCamError) {
                            console.log('ì „ë©´ ì¹´ë©”ë¼ ì‹¤íŒ¨, ê¸°ë³¸ ì¹´ë©”ë¼ ì‹œë„...');
                            // 3ì°¨: ê¸°ë³¸ ì¹´ë©”ë¼ ì‹œë„
                            stream = await navigator.mediaDevices.getUserMedia({ 
                                video: {
                                    width: { ideal: 640 },
                                    height: { ideal: 480 }
                                },
                                audio: false
                            });
                        }
                    }

                    if (stream) {
                        cameraStream = stream;
                        video.srcObject = stream;
                        
                        // ë¹„ë””ì˜¤ ì¬ìƒ ì‹œì‘
                        video.play().then(() => {
                            console.log('ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ ì‹œì‘ë¨');
                            btn.textContent = t.cameraOff;
                            isCameraOn = true;
                            
                            // AR ë§ˆì»¤ë“¤ í™œì„±í™”
                            activateARMarkers();
                            
                            alert('ì¹´ë©”ë¼ê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤! AR ì•ˆë‚´ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.');
                        }).catch(playError => {
                            console.error('ë¹„ë””ì˜¤ ì¬ìƒ ì˜¤ë¥˜:', playError);
                            throw new Error('ì¹´ë©”ë¼ í™”ë©´ì„ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        });
                    }
                    
                } catch (err) {
                    console.error('ì¹´ë©”ë¼ ì ‘ê·¼ ì˜¤ë¥˜:', err);
                    
                    let errorMessage = 'ì¹´ë©”ë¼ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\nê°€ëŠ¥í•œ í•´ê²°ë°©ë²•:\n';
                    errorMessage += '1. ë¸Œë¼ìš°ì €ì—ì„œ ì¹´ë©”ë¼ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”\n';
                    errorMessage += '2. HTTPS í™˜ê²½ì—ì„œ ì ‘ì†í•´ì£¼ì„¸ìš”\n';
                    errorMessage += '3. ë‹¤ë¥¸ ì•±ì—ì„œ ì¹´ë©”ë¼ë¥¼ ì‚¬ìš© ì¤‘ì´ë©´ ì¢…ë£Œí•´ì£¼ì„¸ìš”\n';
                    errorMessage += '4. ë¸Œë¼ìš°ì €ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”';
                    
                    alert(errorMessage);
                    
                    // ê¶Œí•œ ìƒíƒœ í™•ì¸
                    checkCameraPermission();
                }
            } else {
                // ì¹´ë©”ë¼ ë„ê¸°
                if (cameraStream) {
                    cameraStream.getTracks().forEach(track => {
                        track.stop();
                        console.log('ì¹´ë©”ë¼ íŠ¸ë™ ì¤‘ì§€:', track.kind);
                    });
                    video.srcObject = null;
                    cameraStream = null;
                }
                btn.textContent = t.cameraOn;
                isCameraOn = false;
                
                // AR ë§ˆì»¤ë“¤ ë¹„í™œì„±í™”
                deactivateARMarkers();
                
                console.log('ì¹´ë©”ë¼ ë¹„í™œì„±í™”ë¨');
            }
        }

        // ì¹´ë©”ë¼ ê¶Œí•œ ìƒíƒœ í™•ì¸
        async function checkCameraPermission() {
            try {
                if (navigator.permissions && navigator.permissions.query) {
                    const permission = await navigator.permissions.query({ name: 'camera' });
                    console.log('ì¹´ë©”ë¼ ê¶Œí•œ ìƒíƒœ:', permission.state);
                    
                    if (permission.state === 'denied') {
                        alert('ì¹´ë©”ë¼ ê¶Œí•œì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.\në¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ì¹´ë©”ë¼ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.');
                        showCameraPermissionGuide();
                    }
                    
                    permission.addEventListener('change', () => {
                        console.log('ì¹´ë©”ë¼ ê¶Œí•œ ìƒíƒœ ë³€ê²½:', permission.state);
                    });
                }
            } catch (error) {
                console.error('ê¶Œí•œ í™•ì¸ ì˜¤ë¥˜:', error);
            }
        }

        // ì¹´ë©”ë¼ ê¶Œí•œ ê°€ì´ë“œ í‘œì‹œ
        function showCameraPermissionGuide() {
            const guide = document.createElement('div');
            guide.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                z-index: 1000;
                max-width: 350px;
                text-align: center;
            `;
            
            guide.innerHTML = `
                <h3>ì¹´ë©”ë¼ ê¶Œí•œ ì„¤ì • ë°©ë²•</h3>
                <p><strong>Chrome/Safari:</strong></p>
                <p>1. ì£¼ì†Œì°½ ì™¼ìª½ ğŸ”’ í´ë¦­</p>
                <p>2. ì¹´ë©”ë¼ â†’ í—ˆìš© ì„ íƒ</p>
                <p>3. í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨</p>
                <br>
                <button onclick="this.parentElement.remove()" 
                        style="background:#4CAF50; color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer;">
                    í™•ì¸
                </button>
            `;
            
            document.body.appendChild(guide);
            
            setTimeout(() => {
                if (guide.parentElement) {
                    guide.remove();
                }
            }, 10000);
        }

        // AR ë§ˆì»¤ í™œì„±í™”
        function activateARMarkers() {
            const markers = document.querySelectorAll('.marker');
            markers.forEach((marker, index) => {
                marker.style.animation = `bounce 1.5s infinite ${index * 0.3}s`;
                marker.style.opacity = '1';
            });
            
            // ê°€ìƒ AR ê°ì²´ë“¤ ì¶”ê°€
            addVirtualARObjects();
        }

        // AR ë§ˆì»¤ ë¹„í™œì„±í™”
        function deactivateARMarkers() {
            const markers = document.querySelectorAll('.marker');
            markers.forEach(marker => {
                marker.style.animation = 'none';
                marker.style.opacity = '0.5';
            });
            
            // ê°€ìƒ AR ê°ì²´ë“¤ ì œê±°
            removeVirtualARObjects();
        }

        // ê°€ìƒ AR ê°ì²´ ì¶”ê°€
        function addVirtualARObjects() {
            const arOverlay = document.querySelector('.ar-overlay');
            
            // ë°©í–¥ í™”ì‚´í‘œ ì¶”ê°€
            const arrow = document.createElement('div');
            arrow.id = 'arArrow';
            arrow.style.cssText = `
                position: absolute;
                top: 30%;
                left: 50%;
                transform: translateX(-50%);
                font-size: 60px;
                color: #4CAF50;
                text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
                animation: arPulse 2s infinite;
                z-index: 10;
            `;
            arrow.textContent = 'â¬†ï¸';
            arOverlay.appendChild(arrow);
            
            // ê±°ë¦¬ ë§ ì¶”ê°€
            const distanceRing = document.createElement('div');
            distanceRing.id = 'distanceRing';
            distanceRing.style.cssText = `
                position: absolute;
                top: 60%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 150px;
                height: 150px;
                border: 3px solid #4CAF50;
                border-radius: 50%;
                border-top: 3px solid transparent;
                animation: ringRotate 3s linear infinite;
                opacity: 0.7;
            `;
            arOverlay.appendChild(distanceRing);
            
            // ëª©ì ì§€ í‘œì‹œ ì¶”ê°€
            const destination = document.createElement('div');
            destination.id = 'arDestination';
            destination.style.cssText = `
                position: absolute;
                top: 20%;
                right: 20px;
                background: rgba(255,255,255,0.9);
                padding: 10px;
                border-radius: 10px;
                font-size: 12px;
                font-weight: bold;
                color: #333;
                max-width: 120px;
            `;
            destination.textContent = 'ğŸ¯ ëª©ì ì§€ ë°©í–¥';
            arOverlay.appendChild(destination);
        }

        // ê°€ìƒ AR ê°ì²´ ì œê±°
        function removeVirtualARObjects() {
            const elementsToRemove = ['arArrow', 'distanceRing', 'arDestination'];
            elementsToRemove.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.remove();
                }
            });
        }

        // AR ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
        const arAnimations = `
            @keyframes arPulse {
                0%, 100% { transform: translateX(-50%) scale(1); }
                50% { transform: translateX(-50%) scale(1.2); }
            }
            
            @keyframes ringRotate {
                0% { transform: translate(-50%, -50%) rotate(0deg); }
                100% { transform: translate(-50%, -50%) rotate(360deg); }
            }
        `;
        
        // ìŠ¤íƒ€ì¼ ì‹œíŠ¸ì— ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
        const styleSheet = document.createElement('style');
        styleSheet.textContent = arAnimations;
        document.head.appendChild(styleSheet);

        // ìœ„ì¹˜ ì œì•ˆ (ìë™ì™„ì„±)
        async function getLocationSuggestions(inputField) {
            const input = document.getElementById(inputField);
            const query = input.value.trim();
            
            if (query.length < 2) return;
            
            try {
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=5&accept-language=ko`
                );
                const suggestions = await response.json();
                
                // ê°„ë‹¨í•œ ë“œë¡­ë‹¤ìš´ êµ¬í˜„ (ì‹¤ì œë¡œëŠ” ë” ì •êµí•œ UI í•„ìš”)
                if (suggestions.length > 0) {
                    const firstSuggestion = suggestions[0].display_name;
                    if (confirm(`"${firstSuggestion}"ì„(ë¥¼) ì„ íƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                        input.value = firstSuggestion;
                    }
                }
            } catch (error) {
                console.error('ìœ„ì¹˜ ì œì•ˆ ì˜¤ë¥˜:', error);
            }
        }

        // ì–¸ì–´ ë³€ê²½
        function changeLanguage() {
            const lang = document.getElementById('languageSelect').value;
            const t = translations[lang];
            
            // UI í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            document.getElementById('headerTitle').textContent = t.title;
            document.getElementById('headerSubtitle').textContent = t.subtitle;
            document.getElementById('departureLabel').textContent = t.departure;
            document.getElementById('destinationLabel').textContent = t.destination;
            document.getElementById('departure').placeholder = t.departurePlaceholder;
            document.getElementById('destination').placeholder = t.destinationPlaceholder;
            document.getElementById('searchBtnText').textContent = t.startButton;
            document.getElementById('featuresTitle').textContent = t.features;
            
            // ì¹´ë©”ë¼ ë²„íŠ¼
            const cameraBtn = document.getElementById('cameraBtn');
            if (cameraBtn) {
                cameraBtn.textContent = isCameraOn ? t.cameraOff : t.cameraOn;
            }
            
            // ê¸°ëŠ¥ ì„¤ëª… ì—…ë°ì´íŠ¸
            const features = [
                { title: "ì‹¤ì‹œê°„ GPS ìœ„ì¹˜", desc: "ì •í™•í•œ í˜„ì¬ ìœ„ì¹˜ ê¸°ë°˜ ê²½ë¡œ ì•ˆë‚´" },
                { title: "ì‹¤ì‹œê°„ êµí†µì •ë³´", desc: "ì§€ì—°, ìš´í–‰ì¤‘ë‹¨ ë“± ì‹¤ì‹œê°„ ë°˜ì˜" },
                { title: "AR ì‹¤ì‹œê°„ ì•ˆë‚´", desc: "ì¹´ë©”ë¼ë¡œ ì‹¤ì œ ë°©í–¥ í‘œì‹œ" },
                { title: "ê¸€ë¡œë²Œ ë‹¤êµ­ì–´", desc: "5ê°œ ì–¸ì–´ ì‹¤ì‹œê°„ ë²ˆì—­" }
            ];
            
            // ì–¸ì–´ë³„ ê¸°ëŠ¥ ì„¤ëª… (ê°„ë‹¨íˆ ìœ ì§€)
            document.getElementById('feature1').innerHTML = `<strong>${features[0].title}</strong><br><small>${features[0].desc}</small>`;
            document.getElementById('feature2').innerHTML = `<strong>${features[1].title}</strong><br><small>${features[1].desc}</small>`;
            document.getElementById('feature3').innerHTML = `<strong>${features[2].title}</strong><br><small>${features[2].desc}</small>`;
            document.getElementById('feature4').innerHTML = `<strong>${features[3].title}</strong><br><small>${features[3].desc}</small>`;
        }

        // ë¡œë”© ìƒíƒœ ê´€ë¦¬
        function setLoading(isLoading) {
            const btn = document.getElementById('searchBtn');
            const loading = document.getElementById('loading');
            const text = document.getElementById('searchBtnText');
            
            if (isLoading) {
                btn.disabled = true;
                loading.style.display = 'block';
                text.style.opacity = '0';
            } else {
                btn.disabled = false;
                loading.style.display = 'none';
                text.style.opacity = '1';
            }
        }

        // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('languageSelect').addEventListener('change', changeLanguage);

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            changeLanguage();
            getCurrentLocation(); // ìë™ìœ¼ë¡œ í˜„ì¬ ìœ„ì¹˜ ê°ì§€
            checkHTTPS(); // HTTPS í™˜ê²½ ì²´í¬
            checkCameraSupport(); // ì¹´ë©”ë¼ ì§€ì› ì²´í¬
        });

        // HTTPS í™˜ê²½ ì²´í¬
        function checkHTTPS() {
            if (location.protocol !== 'https:' && location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
                document.getElementById('httpsWarning').style.display = 'block';
                console.warn('HTTPS í™˜ê²½ì´ ì•„ë‹™ë‹ˆë‹¤. ì¹´ë©”ë¼ ì ‘ê·¼ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì¹´ë©”ë¼ ì§€ì› ì²´í¬
        function checkCameraSupport() {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                showError('ì´ ë¸Œë¼ìš°ì €ëŠ” ì¹´ë©”ë¼ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                document.getElementById('cameraBtn').disabled = true;
                document.getElementById('cameraBtn').textContent = 'ì¹´ë©”ë¼ ì§€ì› ì•ˆë¨';
            }
        }

        // HTTPS ê°€ì´ë“œ í‘œì‹œ
        function showHTTPSGuide() {
            const guide = `
HTTPS í™˜ê²½ ì„¤ì • ë°©ë²•:

1. GitHub Pages ì‚¬ìš©:
   - GitHubì— ì½”ë“œ ì—…ë¡œë“œ
   - Settings â†’ Pages í™œì„±í™”
   - https://[username].github.io/[repo] ì ‘ì†

2. Netlify ì‚¬ìš©:
   - netlify.comì—ì„œ íŒŒì¼ ë“œë˜ê·¸ ì•¤ ë“œë¡­
   - ìë™ìœ¼ë¡œ HTTPS URL ìƒì„±

3. ngrok ì‚¬ìš©:
   - ngrok.com ë‹¤ìš´ë¡œë“œ
   - 'ngrok http 5500' ì‹¤í–‰
   - ìƒì„±ëœ https URL ì‚¬ìš©

4. ë¡œì»¬ì—ì„œ HTTPS:
   - VS Code Live Server ì„¤ì •ì—ì„œ HTTPS í™œì„±í™”
            `;
            alert(guide);
        }

        // ê¶Œí•œ ìš”ì²­ ë‹¤ì´ì–¼ë¡œê·¸
        function requestCameraPermission() {
            document.getElementById('permissionOverlay').style.display = 'none';
            toggleCamera();
        }

        function closePermissionDialog() {
            document.getElementById('permissionOverlay').style.display = 'none';
        }

        // ì¹´ë©”ë¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateCameraStatus(status) {
            const statusElement = document.getElementById('cameraStatus');
            const lang = document.getElementById('languageSelect').value;
            
            const statusTexts = {
                ko: {
                    off: 'ì¹´ë©”ë¼ êº¼ì§',
                    requesting: 'ê¶Œí•œ ìš”ì²­ ì¤‘...',
                    active: 'ğŸ”´ ì¹´ë©”ë¼ í™œì„±',
                    error: 'ì¹´ë©”ë¼ ì˜¤ë¥˜'
                },
                en: {
                    off: 'Camera Off',
                    requesting: 'Requesting...',
                    active: 'ğŸ”´ Camera Active',
                    error: 'Camera Error'
                },
                es: {
                    off: 'CÃ¡mara Apagada',
                    requesting: 'Solicitando...',
                    active: 'ğŸ”´ CÃ¡mara Activa',
                    error: 'Error de CÃ¡mara'
                }
            };
            
            const text = statusTexts[lang] ? statusTexts[lang][status] : statusTexts.ko[status];
            statusElement.textContent = text;
            
            if (status === 'active') {
                statusElement.classList.add('camera-active');
            } else {
                statusElement.classList.remove('camera-active');
            }
        }

        // ì‹¤ì‹œê°„ ìœ„ì¹˜ ì¶”ì  (ì˜µì…˜)
        function startLocationTracking() {
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(
                    function(position) {
                        userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        
                        // ê²½ë¡œ ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸
                        if (currentRoute) {
                            updateRouteProgress();
                        }
                    },
                    function(error) {
                        console.error('ìœ„ì¹˜ ì¶”ì  ì˜¤ë¥˜:', error);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 5000,
                        maximumAge: 10000
                    }
                );
            }
        }

        // ê²½ë¡œ ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸
        function updateRouteProgress() {
            // ì‹¤ì œ ìœ„ì¹˜ì™€ ê²½ë¡œë¥¼ ë¹„êµí•˜ì—¬ ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸
            // ì´ ë¶€ë¶„ì€ ë” ë³µì¡í•œ ì•Œê³ ë¦¬ì¦˜ì´ í•„ìš”í•¨
            console.log('ê²½ë¡œ ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸');
        }
    </script>
</body>
</html>